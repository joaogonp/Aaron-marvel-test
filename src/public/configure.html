<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Marvel Universe - Craft Your Addon</title>
    <!-- Vue.js -->
    <script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.js"></script>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        marvelred: {
                            light: '#ff6b6b',
                            DEFAULT: '#dc2626',
                            dark: '#b91c1c',
                        },
                        marvelgold: {
                            light: '#fef08a',
                            DEFAULT: '#facc15',
                            dark: '#ca8a04',
                        },
                        marveldark: {
                            light: '#1f2937',
                            DEFAULT: '#111827',
                            dark: '#0f172a',
                        }
                    },
                    boxShadow: {
                        'marvel-glow': '0 0 15px rgba(220, 38, 38, 0.3)',
                        'marvel-card': '0 4px 20px rgba(0, 0, 0, 0.2)',
                    },
                    keyframes: {
                        spinGlow: {
                            '0%, 100%': { boxShadow: '0 0 10px rgba(220, 38, 38, 0.5)' },
                            '50%': { boxShadow: '0 0 20px rgba(220, 38, 38, 0.8)' },
                        }
                    },
                    animation: {
                        'spin-glow': 'spinGlow 2s ease-in-out infinite',
                    }
                }
            }
        }
    </script>
    <style>
        [v-cloak] { display: none; }

        /* Custom animations */
        .rotate-fade-enter-active, .rotate-fade-leave-active {
            transition: all 0.4s ease;
        }
        .rotate-fade-enter, .rotate-fade-leave-to {
            opacity: 0;
            transform: rotateY(10deg);
        }

        .fade-enter-active, .fade-leave-active {
            transition: opacity 0.5s;
        }
        .fade-enter, .fade-leave-to {
            opacity: 0;
        }

        /* Card styles */
        .catalog-card {
            background-size: cover;
            background-position: center;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        .catalog-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(to bottom, rgba(17, 24, 39, 0.7), rgba(17, 24, 39, 0.9));
            z-index: 0;
        }
        .catalog-card:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
        }
        .catalog-card.selected {
            border: 3px solid #facc15;
        }
        .dark .catalog-card.selected {
            border-color: #fef08a;
        }
        .card-content {
            position: relative;
            z-index: 1;
        }

        /* Button glow effect */
        .marvel-button {
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
        }
        .marvel-button:hover {
            box-shadow: 0 0 15px rgba(220, 38, 38, 0.5);
        }

        /* Masonry grid */
        .masonry-grid {
            column-count: 1;
            column-gap: 1.5rem;
        }
        @media (min-width: 640px) {
            .masonry-grid {
                column-count: 2;
            }
        }
        @media (min-width: 1024px) {
            .masonry-grid {
                column-count: 3;
            }
        }
        .masonry-item {
            break-inside: avoid;
            margin-bottom: 1.5rem;
        }

        /* Header styles */
        .header {
            background: linear-gradient(45deg, #111827 0%, #dc2626 100%);
        }

        /* Notification styles */
        .notification {
            position: fixed;
            top: 1rem;
            right: 1rem;
            z-index: 1000;
        }

        /* Responsive adjustments */
        @media (max-width: 640px) {
            .header-title {
                font-size: 1.25rem !important;
            }
            .catalog-card {
                min-height: 200px !important;
            }
            .marvel-button {
                padding: 0.5rem 1rem;
            }
        }
    </style>
</head>
<body class="bg-marveldark dark:bg-marveldark-dark text-white">
    <div id="app" v-cloak>
        <!-- Header -->
        <header class="header py-4 shadow-lg">
            <div class="container mx-auto px-4 flex items-center justify-between">
                <div class="flex items-center space-x-3">
                    <img src="https://raw.githubusercontent.com/joaogonp/addon-marvel/main/assets/icon.png" alt="Marvel Universe Logo" class="w-12 h-12 object-contain">
                    <h1 class="header-title text-2xl md:text-3xl font-bold">Marvel Universe Addon</h1>
                </div>
                <div class="flex items-center space-x-4">
                    <button @click="toggleDarkMode" class="text-marvelgold hover:text-marvelgold-light" title="Toggle Dark Mode">
                        <i class="fas" :class="darkMode ? 'fa-sun' : 'fa-moon'"></i>
                    </button>
                    <button 
                        @click="generateLink" 
                        class="marvel-button bg-marvelred text-white px-4 py-2 rounded-lg hover:bg-marvelred-dark disabled:opacity-50 disabled:cursor-not-allowed"
                        :disabled="selectedCatalogs.length === 0"
                    >
                        <i class="fas fa-rocket mr-2"></i>Create Addon
                    </button>
                </div>
            </div>
        </header>

        <!-- Main content -->
        <main class="container mx-auto px-4 py-8">
            <!-- Intro section -->
            <section class="text-center mb-12">
                <h2 class="text-3xl md:text-4xl font-extrabold mb-4">Forge Your Marvel Journey</h2>
                <p class="text-lg text-gray-300 max-w-2xl mx-auto">
                    Handpick your favorite Marvel catalogs to build a tailored Stremio addon that suits your fandom.
                </p>
                <div class="mt-6 flex justify-center space-x-4">
                    <button 
                        @click="selectAll" 
                        class="marvel-button bg-marvelgold text-marveldark px-4 py-2 rounded-lg hover:bg-marvelgold-light"
                    >
                        <i class="fas fa-check-circle mr-2"></i>Pick All
                    </button>
                    <button 
                        @click="deselectAll" 
                        class="marvel-button bg-gray-700 text-white px-4 py-2 rounded-lg hover:bg-gray-600"
                    >
                        <i class="fas fa-times-circle mr-2"></i>Clear
                    </button>
                </div>
            </section>

            <!-- Filters -->
            <section class="mb-8 flex justify-center space-x-4">
                <button 
                    @click="toggleCategoryFilter('')" 
                    class="px-4 py-2 rounded-full text-sm font-medium"
                    :class="currentCategory === '' ? 'bg-marvelred text-white' : 'bg-gray-700 text-gray-300 hover:bg-gray-600'"
                >
                    All
                </button>
                <button 
                    v-for="category in categories" 
                    :key="category" 
                    @click="toggleCategoryFilter(category)"
                    class="px-4 py-2 rounded-full text-sm font-medium"
                    :class="currentCategory === category ? 'bg-marvelred text-white' : 'bg-gray-700 text-gray-300 hover:bg-gray-600'"
                >
                    {{ category }}
                </button>
            </section>

            <!-- Selected catalogs -->
            <div class="mb-8 bg-marveldark-light rounded-lg p-4 flex items-center justify-between">
                <span class="text-lg">
                    <strong>{{ selectedCatalogs.length }}</strong> {{ selectedCatalogs.length === 1 ? 'Catalog Selected' : 'Catalogs Selected' }}
                </span>
                <span class="text-sm text-gray-400">
                    <i class="fas fa-info-circle mr-1"></i>Click cards to select
                </span>
            </div>

            <!-- Catalog cards -->
            <div class="masonry-grid">
                <transition-group name="rotate-fade" tag="div" class="masonry-grid">
                    <div 
                        v-for="catalog in filteredCatalogs" 
                        :key="catalog.id" 
                        @click="toggleCatalog(catalog)"
                        class="masonry-item catalog-card rounded-lg shadow-marvel-card cursor-pointer min-h-[250px] flex flex-col justify-end"
                        :class="{'selected': selectedCatalogs.includes(catalog.id)}"
                        :style="{ backgroundImage: `url(${getCatalogImage(catalog.id)})` }"
                    >
                        <div class="card-content p-4">
                            <div class="flex items-center mb-2">
                                <i :class="'fas fa-' + getIconForCatalog(catalog)" class="text-3xl text-marvelgold mr-3"></i>
                                <h3 class="text-lg font-bold">{{ catalog.name }}</h3>
                            </div>
                            <p class="text-sm text-gray-300 mb-3">{{ catalog.description }}</p>
                            <div class="flex justify-between items-center">
                                <span class="text-xs bg-marveldark px-2 py-1 rounded-full">{{ catalog.category }}</span>
                                <input 
                                    type="checkbox" 
                                    :id="catalog.id" 
                                    :value="catalog.id" 
                                    v-model="selectedCatalogs"
                                    class="h-5 w-5 accent-marvelgold"
                                    @click.stop
                                >
                            </div>
                        </div>
                    </div>
                </transition-group>
            </div>

            <!-- Installation panel -->
            <transition name="fade">
                <div v-if="showInstallPanel" class="bg-marveldark-light rounded-lg p-6 mt-12 shadow-marvel-glow">
                    <h3 class="text-2xl font-bold mb-4">Your Marvel Addon Awaits!</h3>
                    <p class="text-gray-300 mb-6">Launch your custom Marvel Universe addon in Stremio with the link below:</p>
                    <div class="flex flex-col sm:flex-row gap-4 mb-6">
                        <a 
                            :href="stremioUrl" 
                            class="marvel-button bg-marvelred text-white px-6 py-3 rounded-lg hover:bg-marvelred-dark text-center"
                        >
                            <i class="fas fa-play-circle mr-2"></i>Install Now
                        </a>
                        <button 
                            @click="copyToClipboard" 
                            class="marvel-button bg-gray-700 text-white px-6 py-3 rounded-lg hover:bg-gray-600"
                        >
                            <i class="fas" :class="copied ? 'fa-check' : 'fa-copy'" class="mr-2"></i>
                            {{ copied ? 'Copied!' : 'Copy Link' }}
                        </button>
                    </div>
                    <div class="bg-marveldark p-4 rounded-lg font-mono text-sm break-all">
                        {{ installUrl }}
                    </div>
                    <div class="mt-6">
                        <h4 class="text-lg font-semibold mb-3">Your Selection ({{ selectedCatalogs.length }})</h4>
                        <div class="flex flex-wrap gap-3">
                            <span 
                                v-for="id in selectedCatalogs" 
                                :key="id"
                                class="bg-marvelgold text-marveldark px-3 py-1 rounded-full text-sm flex items-center"
                            >
                                <i class="fas mr-2" :class="'fa-' + getIconForCatalogById(id)"></i>
                                {{ getCatalogName(id) }}
                            </span>
                        </div>
                    </div>
                </div>
            </transition>
        </main>

        <!-- Footer -->
        <footer class="bg-marveldark-dark py-8">
            <div class="container mx-auto px-4 text-center">
                <div class="flex justify-center items-center mb-4">
                    <img src="https://raw.githubusercontent.com/joaogonp/addon-marvel/main/assets/icon.png" alt="Marvel Universe Logo" class="w-10 h-10 object-contain mr-3">
                    <span class="text-lg font-bold">Marvel Universe Addon</span>
                </div>
                <p class="text-gray-400 mb-4">Your gateway to the Marvel multiverse on Stremio</p>
                <div class="flex justify-center space-x-6">
                    <a href="https://github.com/joaogonp/addon-marvel" target="_blank" class="text-marvelgold hover:text-marvelgold-light">
                        <i class="fab fa-github text-2xl"></i>
                    </a>
                    <a href="https://github.com/joaogonp/addon-marvel/issues" target="_blank" class="text-marvelgold hover:text-marvelgold-light">
                        <i class="fas fa-bug text-2xl"></i>
                    </a>
                </div>
                <p class="text-sm text-gray-500 mt-4">© 2025 Marvel Universe Addon</p>
            </div>
        </footer>

        <!-- Copy notification -->
        <transition name="fade">
            <div v-if="showCopiedToast" class="notification bg-marvelgold text-marveldark px-4 py-2 rounded-lg shadow-lg">
                <i class="fas fa-check mr-2"></i>Link copied!
            </div>
        </transition>
    </div>

    <script>
        new Vue({
            el: '#app',
            data: {
                catalogs: [
                    { 
                        id: 'marvel-mcu', 
                        name: 'MCU Chronological', 
                        category: 'Timeline',
                        description: 'Dive into the MCU in story-driven order',
                        icon: 'calendar-alt'
                    },
                    { 
                        id: 'xmen', 
                        name: 'X-Men Saga', 
                        category: 'Character',
                        description: 'Every X-Men film and spinoff',
                        icon: 'mask'
                    },
                    { 
                        id: 'movies', 
                        name: 'Marvel Films', 
                        category: 'Content Type',
                        description: 'All Marvel cinematic releases',
                        icon: 'film'
                    },
                    { 
                        id: 'series', 
                        name: 'Marvel Shows', 
                        category: 'Content Type',
                        description: 'Binge-worthy Marvel TV series',
                        icon: 'tv'
                    },
                    { 
                        id: 'animations', 
                        name: 'Marvel Animations', 
                        category: 'Content Type',
                        description: 'Vibrant Marvel animated stories',
                        icon: 'play-circle'
                    }
                ],
                selectedCatalogs: [],
                showInstallPanel: false,
                installUrl: '',
                stremioUrl: '',
                currentCategory: '',
                copied: false,
                showCopiedToast: false,
                darkMode: true // Default to dark mode for Marvel theme
            },
            computed: {
                categories() {
                    return [...new Set(this.catalogs.map(c => c.category))];
                },
                filteredCatalogs() {
                    return this.currentCategory 
                        ? this.catalogs.filter(c => c.category === this.currentCategory)
                        : this.catalogs;
                }
            },
            watch: {
                selectedCatalogs(newSelection, oldSelection) {
                    if (this.showInstallPanel && JSON.stringify(newSelection) !== JSON.stringify(oldSelection)) {
                        this.showInstallPanel = false;
                    }
                }
            },
            methods: {
                toggleDarkMode() {
                    this.darkMode = !this.darkMode;
                    document.documentElement.classList.toggle('dark', this.darkMode);
                    localStorage.setItem('darkMode', this.darkMode ? 'enabled' : 'disabled');
                },
                selectAll() {
                    this.selectedCatalogs = this.catalogs.map(c => c.id);
                },
                deselectAll() {
                    this.selectedCatalogs = [];
                },
                toggleCatalog(catalog) {
                    const index = this.selectedCatalogs.indexOf(catalog.id);
                    if (index === -1) {
                        this.selectedCatalogs.push(catalog.id);
                    } else {
                        this.selectedCatalogs.splice(index, 1);
                    }
                },
                generateLink() {
                    if (this.selectedCatalogs.length === 0) {
                        alert('Select at least one catalog to proceed.');
                        return;
                    }

                    const host = window.location.host;
                    const protocol = window.location.protocol;
                    const allCatalogIds = this.catalogs.map(c => c.id);
                    const sortedSelected = [...this.selectedCatalogs].sort();
                    const sortedAll = [...allCatalogIds].sort();
                    const allSelected = sortedSelected.length === sortedAll.length && sortedSelected.every((val, idx) => val === sortedAll[idx]);

                    if (allSelected) {
                        this.installUrl = `${protocol}//${host}/manifest.json`;
                        this.stremioUrl = `stremio://${host}/manifest.json`;
                    } else {
                        const catalogParam = this.selectedCatalogs.join(',');
                        this.installUrl = `${protocol}//${host}/catalog/${encodeURIComponent(catalogParam)}/manifest.json`;
                        this.stremioUrl = `stremio://${host}/catalog/${encodeURIComponent(catalogParam)}/manifest.json`;
                    }

                    this.showInstallPanel = true;
                    setTimeout(() => {
                        const panel = document.querySelector('.bg-marveldark-light');
                        if (panel) {
                            panel.scrollIntoView({ behavior: 'smooth', block: 'start' });
                        }
                    }, 100);
                },
                getCatalogName(id) {
                    const catalog = this.catalogs.find(c => c.id === id);
                    return catalog ? catalog.name : id;
                },
                toggleCategoryFilter(category) {
                    this.currentCategory = this.currentCategory === category ? '' : category;
                },
                getCategoryIcon(category) {
                    const iconMap = {
                        'Timeline': 'fas fa-clock',
                        'Content Type': 'fas fa-film',
                        'Character': 'fas fa-mask'
                    };
                    return iconMap[category] || 'fas fa-folder';
                },
                getIconForCatalog(catalog) {
                    return catalog.icon || 'folder';
                },
                getIconForCatalogById(id) {
                    const catalog = this.catalogs.find(c => c.id === id);
                    return catalog ? (catalog.icon || 'folder') : 'folder';
                },
                getCatalogImage(id) {
                    // Placeholder images (replace with real assets if available)
                    const imageMap = {
                        'marvel-mcu': 'https://images.unsplash.com/photo-1621849400072-3f4d1eb38892?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80',
                        'xmen': 'https://images.unsplash.com/photo-1621849400072-3f4d1eb38892?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80',
                        'movies': 'https://images.unsplash.com/photo-1621849400072-3f4d1eb38892?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80',
                        'series': 'https://images.unsplash.com/photo-1621849400072-3f4d1eb38892?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80',
                        'animations': 'https://images.unsplash.com/photo-1621849400072-3f4d1eb38892?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80'
                    };
                    return imageMap[id] || 'https://images.unsplash.com/photo-1621849400072-3f4d1eb38892?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80';
                },
                copyToClipboard() {
                    navigator.clipboard.writeText(this.installUrl).then(() => {
                        this.copied = true;
                        this.showCopiedToast = true;
                        setTimeout(() => this.showCopiedToast = false, 2000);
                        setTimeout(() => this.copied = false, 3000);
                    }).catch(err => {
                        console.error('Failed to copy:', err);
                    });
                },
                checkDarkModePreference() {
                    const savedMode = localStorage.getItem('darkMode');
                    if (savedMode === 'enabled' || (!savedMode && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
                        this.darkMode = true;
                        document.documentElement.classList.add('dark');
                    }
                }
            },
            created() {
                let initialSelectedIds = [];
                const path = window.location.pathname;
                const parts = path.split('/');

                const allAvailableCatalogIds = this.catalogs.map(c => c.id);
                if (parts.length === 4 && parts[1].toLowerCase() === 'catalog' && parts[3].toLowerCase() === 'configure') {
                    const encodedIdsString = parts[2];
                    if (encodedIdsString) {
                        const idsString = decodeURIComponent(encodedIdsString);
                        const potentialIds = idsString.split(',').map(id => id.trim()).filter(id => id);
                        initialSelectedIds = potentialIds.filter(id => allAvailableCatalogIds.includes(id));
                    }
                }

                this.selectedCatalogs = initialSelectedIds.length > 0 ? initialSelectedIds : allAvailableCatalogIds;
            },
            mounted() {
                this.checkDarkModePreference();
            }
        });
    </script>
</body>
</html>
